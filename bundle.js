!function(){"use strict";class e{constructor(e){this._identifier={},this._properties={...e},this._parent=null,this._root=null,this._model=null,this._children=[],this._listeners=[]}get identifier(){return this._identifier}get properties(){return this._properties}get root(){return this._root}get model(){return this._model}listen(e,t,i){const s=e.listen(t,i);return this._listeners.push(s),s}run(e,i){i.binding._parent=this,this._children.push(i.binding),i.binding._properties={...this.properties,...i.binding.properties},t.run(e,{parentNode:this.root,...i})}remove(){const e=this._listeners.slice();for(const t of e)t.remove();const t=this._children.slice();for(const e of t)e.remove();null!==this._parent&&(this._parent._children=this._parent._children.filter((e=>e!==this))),this.root.remove()}onCreated(){}async onRendered(){}}class t{static PROPERTIES=["tagName","children","identifier","model","binding","properties"];static METHOD={APPEND_CHILD:"APPEND_CHILD",INSERT_BEFORE:"INSERT_BEFORE",REPLACE_NODE:"REPLACE_NODE",WRAP_NODE:"WRAP_NODE",PREPEND:"PREPEND"};static run(i,{parentNode:s,method:n=t.METHOD.APPEND_CHILD,binding:o=new e}={}){const r=t.createNode(s,i,o);o._root=r,o._model=i,o.onCreated(),n===t.METHOD.APPEND_CHILD?s.appendChild(r):n===t.METHOD.INSERT_BEFORE?s.parentNode.insertBefore(r,s):n===t.METHOD.REPLACE_NODE?s.replaceWith(r):n===t.METHOD.WRAP_NODE?(r.appendChild(s.cloneNode(!0)),s.replaceWith(r)):n===t.METHOD.PREPEND&&s.prepend(r),o.onRendered()}static createNode(e,i,s){const{tagName:n,children:o=[]}=i,r=e.ownerDocument.createElement(n);Object.keys(i).filter((e=>!1===t.PROPERTIES.includes(e))).forEach((function(e){r[e]=i[e]}));for(const i of o)if(!0===Object.prototype.hasOwnProperty.call(i,"model")){let e;!0===Object.prototype.hasOwnProperty.call(i,"binding")&&(e=new i.binding({...s.properties,...i.properties}),!0===Object.prototype.hasOwnProperty.call(i,"identifier")&&(s.identifier[i.identifier]=e)),s.run(i.model,{parentNode:r,binding:e})}else{const n=t.createNode(e,i,s);r.appendChild(n)}return!0===Object.prototype.hasOwnProperty.call(i,"identifier")&&(s.identifier[i.identifier]=r),r}}class i{constructor(e,t,i){this._observable=e,this._eventName=t,this._callback=i}remove(){this._observable.removeListener(this)}get eventName(){return this._eventName}get callback(){return this._callback}}var s={tagName:"div",className:"player show",children:[{tagName:"div",identifier:"cloak",className:"cloak"},{tagName:"div",className:"controls",identifier:"controls",children:[{tagName:"button",identifier:"pipButton",textContent:"↙️"},{tagName:"button",identifier:"lightButton",textContent:"💡"}]},{tagName:"div",identifier:"media",className:"media",children:[{tagName:"div",className:"overlay"}]}]},n={27:"fullscreen disable",70:"fullscreen toggle",84:"light toggle"};class o extends e{onCreated(){const{player:e,model:t,binding:i}=this.properties;this._hotkeys={...n},this.listen(e,"hotkeys add",(e=>{this._hotkeys={...this._hotkeys,...e}})),this.listen(e,"pip toggle",(()=>{this.root.classList.toggle("minimized"),this.root.classList.contains("minimized")?(this.identifier.pipButton.textContent="↖️",this.identifier.lightButton.style.display="none"):(this.identifier.pipButton.textContent="↙️",this.identifier.lightButton.style.display="")})),this.listen(e,"light toggle",(()=>this.identifier.cloak.classList.toggle("off"))),this.listen(e,"error",(()=>{this.identifier.media.classList.remove("loading"),this.identifier.media.classList.add("error")})),this.listen(e,"loading",(()=>{this.identifier.media.classList.remove("error"),this.identifier.media.classList.add("loading")})),this.listen(e,"fullscreen toggle",(()=>{null!==document.fullscreenElement?document.exitFullscreen():this.root.requestFullscreen()})),this.listen(e,"fullscreen disable",(()=>{null!==document.fullscreenElement&&document.exitFullscreen()})),this.identifier.pipButton.addEventListener("click",(()=>{e.emit("pip toggle")})),this.identifier.lightButton.addEventListener("click",(()=>{e.emit("light toggle")})),this.root.ownerDocument.addEventListener("fullscreenchange",(()=>{null!==document.fullscreenElement?this.root.classList.add("fullscreen"):this.root.classList.remove("fullscreen")})),this.root.ownerDocument.defaultView.addEventListener("keydown",(t=>{Object.hasOwnProperty.call(this._hotkeys,t.keyCode)&&e.emit(this._hotkeys[t.keyCode])})),this.run(t,{parentNode:this.identifier.media,binding:i})}}class r extends class{constructor(){this._listeners={}}listen(e,t){Array.isArray(this._listeners[e])||(this._listeners[e]=[]);const s=new i(this,e,t);return this._listeners[e].push(s),s}removeListener(e){this._listeners[e.eventName]=this._listeners[e.eventName].filter((t=>t!==e))}emit(e,t){if(Array.isArray(this._listeners[e]))for(const i of this._listeners[e])i.callback(t)}}{constructor(){super()}}var d={tagName:"div",className:"streaming"},a={75:"playback toggle",67:"hud show",32:"playback toggle",74:"video skip backward",37:"video skip backward",38:"video speed increase",39:"video skip forward",76:"video skip forward",40:"video speed decrease",77:"video volume toggle"},l={tagName:"video"};const h=function(e,t){let i="";for(let s=0;s<t-e.toString().length;s++)i=i.concat("0");return i=i.concat(e),i},u=function(e){e=e||0;let t=Math.floor(e/3600);e%=3600;let i=Math.floor(e/60);return e=Math.floor(e%60),(t>0?h(t,2)+":":"").concat(h(i,2)).concat(":"+h(e,2))};const c="hsla(0, 0% ,20%, 0.5)";const m="hsla(0, 0% ,20%, 0.5)";var p,f={tagName:"div",className:"video_hud",children:[{tagName:"button",textContent:"▶️",identifier:"play",title:"Play/Pause"},{model:{tagName:"div",className:"seekbar",children:[{tagName:"input",identifier:"timeline",type:"range",value:0,min:0,step:"any"}]},binding:class extends e{repaint(){const e=this.buffered;for(let t=e.length;t--;)if(this.currentTime>=e.start(t)&&this.currentTime<=e.end(t)){const i={currentTime:100*this.currentTime/this.duration,bufferStart:100*e.start(t)/this.duration,bufferEnd:100*e.end(t)/this.duration};null!==this.offsetX?(i.cursorTime=100*this.offsetX/this.identifier.timeline.offsetWidth,i.cursorTime<i.currentTime?this.identifier.timeline.style.background=`linear-gradient(90deg, #111, #111 ${i.cursorTime}%, ${c} ${i.cursorTime}%, ${c} ${i.currentTime}%, #131313 ${i.currentTime}%, #131313 ${i.bufferEnd}%, transparent ${i.bufferEnd}%, transparent 100%`:this.identifier.timeline.style.background=`linear-gradient(90deg, #111, #111 ${i.currentTime}%, #131313 ${i.currentTime}%, #131313 ${i.bufferEnd}%, ${c} ${i.bufferEnd}%, ${c} ${i.cursorTime}%, transparent ${i.cursorTime}%, transparent 100%`):this.identifier.timeline.style.background=`linear-gradient(90deg, #111, #111 ${i.currentTime}%, #131313 ${i.currentTime}%, #131313 ${i.bufferEnd}%, transparent ${i.bufferEnd}%, transparent 100%`;break}}setTime(e){let t=100*e/this.identifier.timeline.offsetWidth,i=this.identifier.timeline.max*t/100;i>this.duration?i=this.duration:i<0&&(i=0),this.properties.player.emit("video time set",i)}onCreated(){const{player:e}=this.properties;let t=!1;this.offsetX=null,this.currentTime=0,this.duration=0,this.buffered=0,this.listen(e,"video loadeddata",(()=>{this.repaint()})),this.listen(e,"video timeupdate",(e=>{this.currentTime=e.currentTime,this.identifier.timeline.value=e.currentTime,this.repaint()})),this.listen(e,"video durationchange",(e=>{this.duration=e.duration,this.identifier.timeline.max=e.duration,this.repaint()})),this.listen(e,"video seeked",(e=>{this.buffered=e})),this.identifier.timeline.addEventListener("click",(e=>{this.setTime(e.offsetX)})),this.identifier.timeline.addEventListener("mousedown",(()=>{t=!0})),this.identifier.timeline.addEventListener("mouseout",(()=>{this.offsetX=null,this.repaint()})),this.identifier.timeline.addEventListener("mousemove",(e=>{!0===t&&this.setTime(e.offsetX),this.offsetX=e.offsetX,this.repaint()})),this.identifier.timeline.addEventListener("mouseup",(()=>{t=!1}))}}},{model:(p={text:"00:00 / 00:00"},{tagName:"div",className:"time-display",textContent:p.text}),binding:class extends e{onCreated(){const{player:e}=this.properties;this.listen(e,"video timeupdate",(e=>{this.root.textContent=`${u(e.currentTime)} / ${u(e.duration)}`})),this.listen(e,"video durationchange",(e=>{this.root.textContent=`${u(e.currentTime)} / ${u(e.duration)}`}))}}},{tagName:"button",identifier:"mute",textContent:"🔊",title:"Toggle volume"},{model:{tagName:"input",className:"volume_slider",type:"range",min:0,value:0,max:1,step:"any"},binding:class extends e{repaint(e){!0===e.muted||0===e.volume?this.root.style.background="":this.root.style.background=`linear-gradient(90deg, #111, #111 ${100*e.volume}%, transparent 0%)`}onCreated(){const{player:e}=this.properties;let t=!1,i=!1,s=1;this.listen(e,"video volumechange",(e=>{this.root.value=e.volume,s=e.volume,i=e.muted,this.repaint(e)})),this.listen(e,"video loadeddata",(e=>{this.root.value=e.volume,s=e.volume,i=e.muted,this.repaint(e)})),this.listen(e,"volume set",(t=>{const s=100*t/this.root.offsetWidth;let n=this.root.max*s/100;n>1?n=1:n<0&&(n=0),e.emit("video volume set",n),n>0&&!0===i&&e.emit("video mute set",!1)})),this.root.addEventListener("click",(t=>{e.emit("volume set",t.offsetX)})),this.root.addEventListener("mousedown",(()=>{t=!0})),this.root.addEventListener("mouseup",(()=>{t=!1})),this.root.addEventListener("mouseout",(()=>{this.repaint({volume:s,muted:i})})),this.root.addEventListener("mousemove",(n=>{!0===t&&e.emit("volume set",n.offsetX);const o=100*s/1,r=100*n.offsetX/this.root.offsetWidth;this.root.style.background=!0===i||0===s?`linear-gradient(90deg, ${m} ${r}%, ${m} ${r}%, transparent ${r}%, transparent 100%`:r<o?`linear-gradient(90deg, #111, #111 ${r}%, ${m} ${r}%, ${m} ${o}%, transparent ${o}%, transparent 100%`:`linear-gradient(90deg, #111, #111 ${o}%, ${m} ${o}%, ${m} ${r}%, transparent ${r}%, transparent 100%`}))}}},{tagName:"button",identifier:"screenshot",textContent:"📷",title:"Take a screenshot"},{tagName:"button",textContent:"🖵",identifier:"fullscreen",title:"Toggle fullscreen"}]};class v extends e{onCreated(){const{player:e}=this.properties;this.listen(e,"screenshot",(()=>{const e=document.createElement("canvas");e.width=this.root.videoWidth,e.height=this.root.videoHeight;e.getContext("2d").drawImage(this.root,0,0,e.width,e.height);const t=e.toDataURL("image/png"),i=document.createElement("a");i.href=t;const s=new Date;i.download=`screenshot-mediaplayer-${s.getDate()}-${s.getMonth()+1}-${s.getFullYear()}-${s.getHours()}-${s.getMinutes()}-${s.getSeconds()}.png`,i.click()})),this.listen(e,"video time set",(e=>{this.root.currentTime=e})),this.listen(e,"video skip backward",(()=>{this.root.currentTime-10>=0?this.root.currentTime-=this.root.duration/10:this.root.currentTime=0})),this.listen(e,"video skip forward",(()=>{this.root.currentTime+this.root.duration/10<=this.root.duration?this.root.currentTime+=this.root.duration/10:this.root.currentTime=this.root.duration})),this.listen(e,"video speed increase",(()=>{this.root.playbackRate+=.5})),this.listen(e,"video speed decrease",(()=>{this.root.playbackRate-=.5})),this.listen(e,"media url set",(e=>{this.root.src=e})),this.listen(e,"video playback toggle",(()=>{!0===this.root.paused?this.root.play():this.root.pause()})),this.listen(e,"video volume toggle",(()=>{this.root.muted=!this.root.muted})),this.listen(e,"video volume set",(e=>{this.root.volume=e})),this.listen(e,"video mute set",(e=>{this.root.muted=e})),this.root.addEventListener("click",(()=>{e.emit("video playback toggle")})),this.root.addEventListener("ended",(()=>{e.emit("media next")})),this.root.addEventListener("error",(e=>{console.log(e)})),this.root.addEventListener("dblclick",(()=>{e.emit("fullscreen toggle")})),this.root.addEventListener("durationchange",(()=>{console.log("durationchange"),e.emit("video durationchange",{duration:this.root.duration,currentTime:this.root.currentTime})})),this.root.addEventListener("loadeddata",(()=>{console.log("loadeddata"),e.emit("video loadeddata",{duration:this.root.duration,volume:this.root.volume,muted:this.root.muted,src:this.root.src,currentTime:this.root.currentTime})})),this.root.addEventListener("loadedmetadata",(()=>{console.log("loadedmetadata"),e.emit("hud show")})),this.root.addEventListener("loadstart",(()=>{console.log("loadstart")})),this.root.addEventListener("pause",(()=>{e.emit("video pause")})),this.root.addEventListener("play",(()=>{e.emit("video play")})),this.root.addEventListener("progress",(()=>{e.emit("video progress")})),this.root.addEventListener("seeked",(()=>{e.emit("video seeked",this.root.buffered)})),this.root.addEventListener("seeking",(()=>{e.emit("video seeking")})),this.root.addEventListener("timeupdate",(()=>{e.emit("video timeupdate",{currentTime:this.root.currentTime,duration:this.root.duration})})),this.root.addEventListener("volumechange",(()=>{e.emit("video volumechange",{volume:this.root.volume,muted:this.root.muted})}))}}class g extends e{hide(){clearTimeout(this.hideTimeout),!1===this.paused&&this.root.classList.add("hidden")}show(){clearTimeout(this.hideTimeout),this.root.classList.remove("hidden"),this.hideTimeout=setTimeout((()=>this.hide()),3e3)}onCreated(){const{player:e}=this.properties;let t=!1;this.hideTimeout=null,this.paused=!1,this.listen(e,"hud hide",(()=>{this.hide()})),this.listen(e,"hud show",(()=>{this.show()})),this.listen(e,"video volumechange",(e=>{!0===e.muted||0===e.volume?this.identifier.mute.textContent="🔇":e.volume<1/3?this.identifier.mute.textContent="🔈":e.volume<.5?this.identifier.mute.textContent="🔉":this.identifier.mute.textContent="🔊"})),this.listen(e,"video pause",(()=>{this.paused=!0,this.identifier.play.textContent="▶️",this.show()})),this.listen(e,"video play",(()=>{this.paused=!1,this.identifier.play.textContent="⏸️",!1===t&&this.hide()})),this.root.addEventListener("mouseover",(()=>{t=!0,this.show()})),this.root.addEventListener("mouseout",(()=>{t=!1,!1===this.paused&&this.hide()})),this.identifier.fullscreen.addEventListener("click",(()=>{e.emit("fullscreen toggle")})),this.identifier.play.addEventListener("click",(()=>{e.emit("video playback toggle")})),this.identifier.mute.addEventListener("click",(()=>{e.emit("video volume toggle")})),this.identifier.screenshot.addEventListener("click",(()=>{e.emit("screenshot")}))}}class E extends e{onCreated(){const{player:e,hotkeys:t}=this.properties;let i,s,n=!1;this.listen(e,"video pause",(()=>{n=!0})),this.listen(e,"video play",(()=>{n=!1})),this.listen(e,"hud hide",(()=>{!1===n&&this.root.classList.add("hide-cursor")})),this.listen(e,"hud show",(()=>{this.root.classList.remove("hide-cursor")})),this.listen(e,"video seeked",(()=>{this.root.className="media"})),this.listen(e,"video seeking",(()=>{this.root.className="media buffering"})),this.root.addEventListener("mousemove",(function(t){!1!==n||void 0!==i&&i===t.x&&s===t.y||e.emit("hud show"),s=t.y,i=t.x})),e.emit("hotkeys add",{...a,...t}),this.run(l,{parentNode:this.root,binding:new v({player:e})}),this.run(f,{parentNode:this.root,binding:new g({player:e})})}}var y={};window.addEventListener("load",(async function(){const e=new r;t.run(s,{parentNode:document.body,binding:new o({player:e,hotkeys:y,model:d,binding:new E({player:e})})}),e.emit("media url set","./resource/trailer.mp4")}))}();
